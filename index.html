<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plate Calculator</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>
  </head>
  <body>
    <div
      x-data="{
          plates: [],
          bar: 0,
          availableBars: [
        {label: 'none - calculate weight for one side, no bar', value: 0},
        {label: 'SZ-Barbell (10kg)', value: 10},
        {label: 'Training Barbell (15kg)', value: 15},
        {label: 'Competition Barbell (20kg)', value: 20},
        ],
        availablePlates: [1.25, 2.5, 5, 10, 15, 20, 25, 45]
    }"
    >
      <div>
        <template x-for="item in availableBars">
          <div>
            <input
              x-model="bar"
              type="radio"
              id="none"
              name="bar"
              :value="item.value"
            />
            <label for="none" x-text="item.label"></label><br />
          </div>
        </template>
      </div>
      <div>
        <template x-for="item in availablePlates">
          <div class="flex">
            <p x-text="item"></p>
            <button @click="addPlate(plates, item)">+</button>
            <button @click="removePlate(plates, item)">-</button>
          </div>
        </template>
      </div>
      <div>
        <p>
          Barbell:
          <span x-text="bar"></span>
        </p>
        <p>
          Plates one Side:
          <span
            x-text="plates.sort(function(a, b){return b-a}).toString()"
          ></span>
          <div class="flex">
              <template x-for="item in plates.sort(function(a, b){return b-a})">
                  <div x-html="getPlateDesign(item)"></div>
              </template>
          </div>
        </p>
        <p>
          Weight one Side:
          <span x-text="calculateOneSide(plates)"></span>
        </p>
        <template x-if="bar>0">
          <p>
            Total:
            <span x-text="calculateTotal(bar, plates)"></span>
          </p>
        </template>
      </div>
    </div>

    <script>
      function addPlate(plates, weight) {
        plates.push(weight);
      }

      function removePlate(plates, weight) {
        var index = plates.indexOf(weight);
        if (index < 0) {
          return;
        }
        plates.splice(index, 1);
      }

      function calculateOneSide(plates) {
        return plates.reduce(add, 0);
      }

      function calculateTotal(bar, plates) {
        return add(parseFloat(bar), 2 * calculateOneSide(plates));
      }

      function add(a, b) {
        return a + b;
      }

      function getPlateDesign(plate){
          var bg_color;
          var text_color;
          var html;

          switch (plate) {
              case 1.25:
                  bg_color='blue'
                  text_color="white"
                  break;
              case 2.5:
                  bg_color='white'
                  text_color="black"
                  break;

              default:
                  bg_color="black"
                  text_color="white"
                  break;
          }
          html = "<div style='background-color:"+ bg_color +";color:"+text_color+"'>" + plate + "</div>";

          return html
      }
    </script>
  </body>
</html>
